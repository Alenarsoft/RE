Персонал
4.23.1	Весь персонал, который перемещается по территории, регистрируется в общей базе данных. Эта база синхронизируется между контроллерами кластера и является единой на весь кластер. Основными данными персоны является ФИО, но как было упомянуто выше, в каждом конкретном кластере можно расширить набор описательных полей. Помимо данных, к каждой персоне можно прикрепить фотографию. При загрузке фотографии уменьшаются по размеру и сжимаются, пока не достигнут размера порядка 30 кб. Таким образом, с учетом размера флеш-памяти на каждой планке Raspberry (от 4 до 32 Гб) система способна хранить до миллиона фотографий.
4.23.2	Панель персонала позволяет фильтровать (искать) людей по фамилии и имени. Первая буква каждого слова в поле ввода вносится автоматически делается заглавной. Поле ввода устроено таким образом, что при вводе одного слова оно трактуется как часть фамилии или имени. Если в поле введено два слова, то первое трактуется как часть фамилии, а второе как часть имени. Поиск по отчеству не осуществляется.
4.23.3	Так же можно дополнительно фильтровать персонал по двум признакам (полям) «Должность» и «Отдел». Поля фильтра работают по логическому «И», т.е. фильтровать можно как по одному признаку, так и по двум сразу. Сбросить все фильтры (ФИО, Должность и Отдел) можно нажав на кнопку «Сбросить все фильтры» (красный крестик). При выборе ФИО персоны в списке, происходит переход в карточку персоны. Если оставить курсор мыши на ФИО не нажимая, то через секунду всплывет фотография персоны под курсором.
4.23.4	Список данных персоны, видимый в панели, определяется настройками полей персонала в меню «Настройки СКД».
4.23.5	При удалении персон из системы выдается предупреждение. После удаления, в целях повышения производительности не производится обновление всего списка персонала. Вместо этого удаленные персоны маркируются другим цветом.
4.23.6	При добавлении или изменении персоны, обязательные для заполнения полей обозначены звездочками. Поля ФИО автоматически сохраняются с первой заглавной буквой в каждом элементе.
4.23.7	Фотография может быть загружена из файла, а может быть сделана с веб-камеры устройства, на котором запущен интерфейс контроллера. Для корректной работы камеры, необходимо разрешить браузеру доступ к камере. Если видеокамер больше одной, пользователь может переключаться между ними.
4.23.8	Одновременно с созданием персоны или после ее создания можно добавить идентификационные карты. Карты добавляются из картотеки. В списке карт всегда показывается не более 10 карт. При наборе цифр, список меняется и показывает первые несколько карт, содержащие введенный номер. Если карта уже выдана, то она показывается как недоступная.
4.23.9	Вместо ручного ввода можно использовать считыватели с точек прохода. Достаточно включить получение карт и при поднесении не выданной карты к любому считывателю карта появится в поле выбора. Для организации нескольких рабочих мест выдачи и для уменьшения вероятности считывания не той карты в поле ожидания точек прохода можно выбрать конкретную точку. В этом случае в веб-интерфейс будут приходить события только с этой точки прохода.
4.23.10	Параметры персоны и профилей доступа можно изменить как для одной конкретной персоны или профиля доступа, так и для нескольких одновременно посредством групповых операций.
4.23.11	Данные по персоналу можно экспортировать в текстовый файл для целей переноса между кластерами, переноса в другие системы или хранения копии. Экспортировать можно как всю базу, так и только выделенные персоны. Формат JSON более удобен для программной обработки или же для переноса данных между кластерами. Формат CSV является стандартом переноса данных между системами и может использоваться для переноса данных во внешние системы, такие как Microsoft Excel, 1С и т.д.
4.24	 Импорт персонала
4.24.1	Данные персонала можно не только экспортировать, но и импортировать в СКУД. При переносе данных из других систем или из других кластеров состав полей персонала может не совпадать. Для таких случаев используется настройка – “Параметры по-умолчанию”. Если импортируемые данные не содержат значения для поля (а поле при этом является обязательным) или содержат неправильное значение, то значение заменяется на указанное.  Для значений типа справочники есть возможность сразу пополнять их новыми значениями. Аналогично с профилями доступа. Если нет профиля с таким именем, то можно потребовать его создание. В этом случае будет создан пустой профиль с указанным именем. В случае с картами, имеется возможность сразу добавить недостающие карты в картотеку и приписать пользователю. Стоит иметь ввиду, что в этом случае у карт будет установлен только код карты. Остальные параметры будут установлены в следующие значения: тип -  многоразовая, уровень привилегий – 1, время действия – 5 лет, описание – «Создана при импорте персонала». Для полного переноса картотеки (карт со всеми свойствами) необходимо импортировать картотеку отдельно (см ниже).
4.24.2	В случае с форматом файла JSON, все остальные данные находятся в файле импорта. Более того, в файле содержится уникальный идентификатор персоны, это позволяет обновлять данные или, наоборот, не трогать объекты, которые уже существуют.
4.24.3	Для формата CSV необходимо настроить соответствие параметров. При выборе файла импорта/Проанализировать данные, считывается первая строка данных. На ее основе необходимо расставить соответствие параметров. Для идентификатора персоны имеется возможность генерировать его автоматически (в большинстве случаев, это правильная настройка, так как нет никакой гарантии, что номер из внешней системы будет уникален). Так как в случае с CSV файлом, как правило, нет идентификатора персоны, то имеется возможность добавить проверку на уникальность по ФИО и/или еще какому-либо полю данных. Например, в организации может быть табельный номер или какой-то другой внутренний способ отличить персонал. Аналогично формату JSON, имеется возможность обновлять существующие объекты (найденные по указанным критериям) либо отбрасывать данные, если объект уже создан.
4.24.4	Для указания пути к файлу с фото нужно обозначить поле (из файла CSV), в котором прописаны наименования фотографий сотрудников с указанием графического формата изображения (например, xxxxx.jpg) и выбрать все фотографии в этом поле. Сами фотографии под соответствующими именами должны быть сохранены на жестком диске компьютера. Программа автоматически сопоставит выбранные фотографии с выделенными в списке и предложит нужные фото для импорта.
4.24.5	Если при импорте персоны оказывается, что ее данные внесены в систему ранее, но эти данные содержат иные идентификационные карты, то они дополняются данными новых идентификационных карт из импортируемого файла.
4.24.6	Программа способна при импорте распознавать ФИО в файлах разных форматов, в том числе использовать ФИО из одного поля файла.

4.25	 Карты
4.25.1	Картотека представляет собой реестр всех карт, используемых в системе для идентификации пользователей. Так как карта является элементом идентификации и ее потеря может повлиять на безопасность объекта,  необходимо вести учет всех карт объекта вне зависимости выдана она в данный момент кому-либо или нет. Таким образом, прежде чем использовать карты для идентификации, карты должны быть добавлены в картотеку.

4.26	 Карты добавление
4.26.1	Карта идентифицирует пользователя, однако помимо кода у нее есть ряд важных характеристик. В первую очередь уровень привилегий или уровень доверия идентификатору. Поведение этого параметра было рассмотрено выше. Во-вторых, карты бывают разовые и многоразовые. Данный параметр влияет на работу картоприемника. Разовые карты забираются картоприемниками (и автоматически отвязываются от персоны становясь опять свободными в картотеке), в то время как многоразовые – нет. У каждой карты есть время ее действия. Даже карты, считающиеся постоянными, имеют время действия (хоть и достаточно большое – несколько лет). Главная цель такого поведения – борьба с естественной утерей карт. Даже если карта утеряна и не была обработана по факту утери, то со временем она все равно перестает идентифицировать персону.
4.26.2	 Если при добавлении карты параметры не заданы, то они берутся из настроек автоматизации ввода. Это позволяет ускорить занесение новых карт.
4.26.3	В системе поддерживается набор действий, выполняемых путем ввода специальных кодов на клавиатурном считывателе. Для защиты от несанкционированного выполнения эти действия сопровождаются авторизацией картой доступа. Для этой цели карта может иметь набор привилегий, разрешающих то или иное действие:
−	Установка режима точек прохода (кроме постановки/снятия режима охраны) – разрешает менять режим точки прохода односимвольной командой;
−	Постановка точки прохода на охрану – разрешает ставить точку прохода на охрану односимвольной командой;
−	Снятие точки прохода с охраны – разрешает снимать точку прохода с охраны односимвольной командой; 
−	Запуск автоматизации – разрешает запускать автоматизацию двухсимвольной командой.
4.26.4	Аналогично карточке персоны поддерживается регистрация карт путем считывания их на точках прохода. Механизм работает точно так же, за исключением того, что система сообщает только об отсутствующих в картотеке картах и не дает повторно вводить уже зарегистрированные.
4.26.5	Параметры карты можно изменить как для одной конкретной карты, так и для нескольких одновременно посредством групповых операций.
4.27	 Карты экспорт и импорт
4.27.1	Экспорт карт в файл и импорт карт из файла работают и настраиваются полностью аналогично экспорту/импорту персонала. 
 
4.28	 Журнал событий
4.28.1	Все происходящие в системе события записываются в журнал. Журнал событий каждого контроллера Rubezh-STRAZH синхронизируется друг с другом. То есть, СКУД любого контроллера содержит события всего кластера. Однако есть несколько специальных случаев. События потери связи с контроллерами кластера не реплицируются, так как они парные (каждый контроллер имеет свое событие потери связи с другим контроллером). Очистка событий по переполнению выполняется каждым контроллером самостоятельно (поддерживается порядка 400 000 событий). Таким образом, точный состав событий может отличаться на разных контроллерах. Однако это не является существенным. 
4.28.2	Все события в журнале разделены на три категории:
−	«Доступ» – логические события о перемещении персонала через точки прохода. Данные события описываются параметрами: время, тип, место, персона.
−	«Аудит» – события доступа в СКУД и изменения данных в ней. Данные события описываются параметрами: время, тип, что изменено, оператор, который изменил. 
−	«Оповещения» – важные события от оборудования и системы. Основное назначение – привлечение внимания для диагностики проблем или срабатывания датчиков. Данные события описываются параметрами: время, тип, контроллер, где произошло, название системы.
4.28.3	События доступа построены по накопительной схеме. По факту успешного или неуспешного прохода через точку порождается всегда одно событие, которое содержит дополнительную информацию, например, о причине отказа в доступе или о типе успешного прохода. Однако в процессе прохода состав события может быть другой, каждая фаза прохода меняет состав начального события. Таким образом, если проход прервется, то событие будет соответствовать точке прерывания. Такая модель позволяет с одной стороны не терять промежуточную информацию, а с другой – не порождать избыточные события.
4.28.4	При наличии датчика положения двери на точке прохода статус события в журнале может фиксироваться в зависимости от срабатывания этого датчика. Если карта поднесена к считывателю, проход разрешается и дверь открывается, то в журнале отмечается событие о фактическом (совершившемся) проходе. Если датчик не зафиксировал открытия двери после разрешения прохода, то фиксируется событие о несостоявшемся проходе.
4.28.5	Если на точке прохода установлен датчик положения двери и после поднесения карты к считывателю проход был запрещён, но на дверь или турникет было осуществлено внешнее воздействие в целях прохода, то в журнале появляется событие о взломе.
4.28.6	Также, если после совершенного прохода датчик зафиксировал, что дверь остается открытой (отсутствует доводчик или дверь зафиксирована, например), то после заданного промежутка времени считыватели подают звуковой сигнал, а в журнал заносится событие об оставлении двери открытой.
4.28.7	Если считывание карт неустойчивое (длинная линия связи или большие помехи), то в журнале могут появляться события с кодом карты вида: #[ <код> ] х <число бит>. В поле код будет содержаться прочитанный код, а число бит скажет о том сколько бит было прочитано.
4.28.8	При потере питания контроллер благодаря суперконденсатору способен некоторое время до отключения сохранить рабочее состояние. За это время контроллером помещается в журнал событие об аварийном отключении при потере питания.
4.28.9	В зависимости от важности или критичности события они подкрашиваются цветом. При просмотре события можно переходить на элементы системы, которые упоминаются в событии (в случае если они еще не удалены).
4.28.10	Журнал событий поддерживает два режима работы: онлайн и работа с архивом. При включении режима онлайн в окно дополнительно подгружаются события ТЕКУЩЕГО дня.
4.28.11	В журнале событий для каждой категории можно настроить параметры данных с помощью фильтров:
−	категория «Доступ» – фильтр по времени, фильтр по типу события, фильтр по точке прохода, фильтр по персоналу;
−	категория «Аудит» – фильтр по времени, фильтр по типу события, фильтр по лицам, совершившим событие;
−	категория «Оповещения» – фильтр по времени, фильтр по типу события, фильтр по объекту.
4.28.12	В целях анализа работы точек прохода журнал событий поддерживает интерактивный (с участием оператора) экспорт событий в файл. Выгрузка файла выполняется непосредственно браузером, поэтому нельзя закрывать окно до окончания выгрузки данных. Поддерживаемый формат файла – CSV.
4.28.13	Для удобства ориентирования во временных рамках журнала событий предусмотрена функция смещения тайм-зоны в событиях. Если точки прохода и журнал событий находятся в разных часовых поясах, то в списке событий отображается время, соответствующее часовому поясу журнала событий, а при выборе конкретного события в его карточке указывается уже время, соответствующее местонахождению точек прохода.
4.28.14	События можно экспортировать в текстовый файл для целей переноса между кластерами, переноса в другие системы или хранения копии. Экспортировать можно как всю базу, так и отдельные события.

4.29	Онлайн мониторинг
4.29.1	В онлайн режиме события всех категорий (Доступ, Аудит, Оповещение) показываются в журнале по факту их возникновения. В этом режиме нельзя выбрать тип события. Максимальное количество событий на странице для каждой категории – 300. При достижении этого количества, в конкретной категории, старые события удаляются с экрана, новые добавляются. Верхнее – текущее событие сразу показывается в виде карточки с деталями (разворачивается).

4.30	Поиски в архиве
4.30.1	В режиме поиска необходимо выбрать категорию события и временной интервал. Диалог выбора временного интервала подставляет значения по факту выбора. Это позволяет, выбрав время, сразу начать поиск (сокращается количество кликов мыши). При выборе временного интервала осуществляется проверка, что временной интервал возможный. При попытке выбрать начало позже конца или события из будущего интерфейс подставляет разрешенные значения и сбрасывает время начала интервала поиска на 0:00, а время конца интервала поиска 23:59. Выдача результатов происходит в списке, подгружаемом по мере прокрутки, нумерация событий идет с конца. Таким образом, первое событие имеет номер, соответствующий общему количеству найденных событий. Важно: так как вывод событий осуществляется по времени, то при неправильном времени контроллера возможны пробелы в выдаче данных (либо данные могут не выдаваться).

4.31	Выгрузка событий доступа во вне
4.31.1	Для целей более подробного анализа событий доступа, а также для построения внешних отчетов учета рабочего времени СКУД поддерживает выгрузку событий.
4.31.2	Простейший способ – интерактивная (с участием оператора) выгрузка событий в файл. В данной выгрузке поддерживается фильтр по времени (с возможностью быстро выбрать текущий день, неделю, месяц), фильтр по точкам прохода и фильтр по персоналу. Фильтр по персоналу позволяет отбирать персон по списочным полям (это удобно для выборки, например подразделения). Можно изменить сортировку данных в файле по ФИО или по времени. Выгрузка файла выполняется непосредственно браузером, поэтому нельзя закрывать окно до окончания выгрузки данных. Поддерживаемый формат файла – CSV
4.31.3	Автоматизированная выгрузка по зонам – вариант выгрузки с использованием вызова API по указанному URL (с авторизацией). Данный способ предназначен для программной интеграции с внешними системами учета рабочего времени. Фактически тут настраиваются параметры выборки, которая будет осуществляться по факту вызова, указанного URL. Так как предполагается периодическая работа внешней системы, то выборка по времени делается относительно момента вызова (сегодня, вчера, текущая неделя, прошлая неделя и т.д.). Основное назначение данного API – выдача информации для внешних систем учета рабочего времени, поэтому необходимой частью обработки данных является определение входов и выходов на территорию.  Для этого используются зоны системы. Можно задавать, как только внешние зоны, только внутренние зоны, так и оба списка. В зависимости от конфигурации логика выборки будет разная:
−	заданы внешние зоны: все переходы из заданных зон – вход. В заданные – выход;
−	заданы внутренние зоны: все переходы из заданных зон – выход. В заданные – вход;
−	заданы и те, и другие внутренние зоны: все переходы из внешних зон во внутренние – вход. Из внутренних во внешние – выход.
4.31.4	Настроенные параметры сохраняются системой. Можно сохранить несколько наборов параметров для построения разных отчетов.
4.31.5	Поддерживаемые форматы файлов – CSV и JSON.
4.32	Отчеты 
4.32.1.	Все совершенные проходы могут быть использованы для оценки времени нахождения персонала на объекте
4.32.2.	Оценить время присутствия и рабочее время можно в разделах отчетов УРВ
4.32.3.	Расчеты УРВ можно посмотреть, как в браузере в табличной форме, так и скачать в форматах CSV, JSON, PDF и XLSX
4.32.4.	Также доступен экспорт событий доступа без расчетов через api метод и через скачивание журнала событий в форматах CSV и JSON.
4.32.5.	Экспортируемые данные можно предварительно отфильтровать по дате, точкам прохода и доп. полям персонала на основе справочника (для данных полей также должна быть включена настройка “Учитывать в результатах поиска”)
4.33	 Настройки отчетов УРВ
4.33.1	Для построения отчета за период нужно предварительно создать шаблон настроек, по которым будут осуществляться расчеты.
4.33.2	В шаблоне можно указать следующие параметры:
●	Имя - название шаблона
●	Период - период, который автоматически выставится при выборе данного шаблона с поправкой на день построения отчета. Доступны для выбора: за вчера и сегодня, текущую и прошлую неделю, текущий и прошлый месяц.
●	Начало рабочего дня - время, с которого должен начинаться учет рабочего времени - на основе данного значения также определяется время опоздания.
●	Окончание рабочего дня - время, до которого учитывается рабочее время - на основе данного параметра определяется уход раньше
●	Длительность рабочего дня - минимальное время, которое персонал должен присутствовать на рабочем месте - на основе этого параметра определяется недоработка и переработка
●	Внешние и Внутренние зоны - на основе выбранных зон определяется вход и выход в учет рабочего времени/времени присутствия. Вход во внешнюю зону будет считаться “Выходом”, а во внутреннюю “Входом”
●	Учитывать зоны - включение учета внутренних и внешних зон для варианта первый вход - последний выход (добавлена для обратной совместимости с предыдущими версиями) по умолчанию выключена. В этом случае зоны учитываться не будут и при расчетах будет браться первый и последний проход по любым зонам за день.
●	Фильтры по персоналу - фильтры по добавленным полям персонала на основе справочников (для данных полей также должна быть включена настройка “Учитывать в результатах поиска”)
4.33.3	Из созданного шаблона можно сразу перейти к расчетам по команде – «Перейти к оформлению отчета»
4.34	 Отчет УРВ за период
4.34.1	В отчете УРВ за период доступен выбор всех ранее созданных шаблонов настроек
4.34.2	Независимо от того какой период был выбран в шаблоне при необходимости можно указать конкретные даты “с” и “по” перед формированием отчета.
4.34.3	Также можно настроить количество отображаемых сотрудников на странице, поле по которому данные будут сгруппированы и доп. поля, которые будут отображаться в таблице. 
4.34.4	И группировка и доп поля используют поля персонала на основе справочника (для данных полей также должна быть включена настройка “Учитывать в результатах поиска”)
4.34.5	После выбора шаблона доступна команда формирования отчета
4.34.6	После формирования отчета становятся доступны дополнительные фильтры и команда скачивания отчета в файл
4.34.7	Дополнительные фильтры позволяют применить поиск по ФИО, а также убрать из отображения сотрудников без рабочего времени или наоборот с рабочим временем.
4.34.8	Скачать отчет можно в четырех форматах: CSV, JSON, PDF и XLSX
4.34.9	Отчет в XLSX доступен в двух представлениях - календарном и табличном.
4.34.10	Календарный вид совпадает по отображению с отчетом в браузере и в PDF, табличный вид включает дополнительные параметры за день как опоздания, уход раньше и количество пропущенных часов рабочего времени.
4.34.11	Отчет в PDF нельзя построить более чем за три месяца или для более 5000 сотрудников, если необходимо выгрузить больше данных следует использовать другие форматы или добавить фильтры 
4.34.12	В случае если сформированный отчет учитывал проходы в течении дня, то при расчетах для каждого дня отчета будут сформированы пары вход-выход. На основе времени сформированных пар определяется общее время присутствия.
4.34.13	В случае если у входа или выхода нет пары, то данный проход не будет учитываться при расчетах.
4.34.14	День, в котором присутствуют проходы без пары будет отмечен.
4.34.15	Так же для любого дня с проходами доступен просмотр всех полученных пар. 
4.34.16	Открыть подсказку с проходами можно при помощи клика на иконку проходов в выбранном дне.
Примечание. Если по каким-то причинам у прохода нет пары, но время парного прохода известно, можно воспользоваться api методом POST http://[ip_контроллера]/api/v1/access_events/user_defined/, для добавления потерянного прохода, подробнее в Описании REST API: https://[ip_контроллера]/api-docs/ui.
4.35	 Настройка экспорта данных УРВ
4.35.1	Дневной отчет можно построить за любой день указав настройки отчета без предварительной настройки шаблона.
4.35.2	Настройки дневного отчета совпадают с настройками шаблона для УРВ за период.
4.35.3	Кроме основных настроек для дневного отчета доступен выбор событий прохода, которые будут использованы в расчетах: все события проходов или только совершенные
4.35.4	Сформированный дневной отчет можно фильтровать по имени и группировать по полям персонала на основе справочника (для данных полей также должна быть включена настройка «Учитывать в результатах поиска»)
4.35.5	Также можно добавить отображение доп. поля в таблице отчета.
4.35.6	В отображение можно добавить только одно доп. поле.
4.36	 Настройка экспорта данных УРВ
4.36.1	Предварительная настройка справочников. Для настройки фильтров в отчетах экспорта данных УРВ рекомендуется добавить несколько справочников, например, “График работы”, “Подразделение” и т.д. Справочники добавляются в разделе “Настройки СКД” подразделе “Справочники”. 
4.36.2	Для того что бы справочники стали доступны в карточке персонала и в фильтрах отчета нужно в подразделе “Поля персонала” добавить созданные справочники, включить для этих полей настройку «Показывать в результатах поиска» и “Применить конфигурацию”
4.36.3	Для настройки отчета экспорта данных УРВ перейти в раздел “Отчеты” подраздел “Настройка экспорта данных УРВ”. В данном подразделе можно создать несколько отчетов для получения данных о проходах по заданным настройкам. В отчете доступна выборка за следующие периоды:
−	За вчера
−	За сегодня
−	За прошлую неделю
−	За текущую неделю
−	За прошлый месяц
−	За текущий месяц
4.36.4	Форма вывода в формате JSON и CSV. Для CSV в качестве разделителя можно указать точку с запятой, запятую или табуляцию.
4.36.5	Для определения зон учета рабочего времени используется настройка Внешних и Внутренних зон.  Вход во внешнюю зону будет считаться “Выходом”, а во внутреннюю “Входом”
4.36.6	Поля вывода одного прохода, получаемого по «Ссылка API»
−	Время прохода - "Date_Time" 
−	Направление прохода - "Zone_control" -  Вход ENTRANCE Выход EXIT,  
−	UUID отчета - "UUID"
−	ФИО сотрудника - "User_full_name" 
−	UUID сотрудника - "User_UUID", 
−	Номер карты - "Card_code" по которой был совершен проход
−	Из какой зоны - "From_zone" совершен проход
−	В какую зону - "To_zone" совершен проход.
4.36.7	На основе этих данных можно определить все пары входов и выходов в зону учета рабочего времени по ним вычислить общее количество часов присутствия, по времени прохода в рамках одних суток можно определить первый вход и последний выход для определения опозданий и уходов раньше и т.д.
