5	Интеграция
5.1	Интеграция с ОПС Рубеж R3
5.1.1	В целях более удобной эксплуатации СКУД на объектах, где установлена охранная система Рубеж R3, контроллеры Rubezh-STRAZH могут взаимодействовать с приборами управления ОПС (Рубеж-2ОП порт.R3 и КАУ).
5.1.2	В результате взаимодействия подсистем пользователь получает возможность управлять некоторыми охранными функциями через любую из этих подсистем:
−	Постановка/снятие с охраны точек доступа СКУД Rubezh-Strazh, через ОПС Рубеж R3;
−	Постановка/снятие с охраны зон ОПС, через точки доступа СКУД Rubezh-Strazh.
−	Формирование тревоги, по факту взлома точки прохода (использование СМК СКУД Rubezh-Strazh в качестве охранного датчика для ОС Рубеж R3)
5.1.3	Для одновременного мониторинга приборов ОС R3 и интеграции со СКУД Rubezh-STRAZH, в интерфейсе RS-485 должно быть минимум два модуля сопряжения. Первый модуль МС-1, подключается к любому контроллеру кластера через USB-порт, и к приборам управления ОПС линии RS-485. Второй модуль (МС-1, МС-2, МС-Е), используется для вывода информации из интерфейса R3 на ПК с ПО FireSec.
5.1.4	После подключения необходимо произвести настройку внутреннего программного обеспечения.
5.1.5	Если нужно использовать функционал, при котором происходит взаимный обмен командами постановки/снятия охранных зон/точек прохода, то создайте список охранных зон в ПО FireSec «Администратор» (не ниже 3.1.5.0), в которые будут помещены адресные охранные извещатели. Вид зоны: «обычная», «с задержкой входа/выхода», «без права снятия».
Важно! МС-1, связывающий R3 и СКУД, в конфигурации ПО FireSec отображается как «Удаленный сервер», подключаемый 	на канал модуля сопряжения.
5.1.6	После создания конфигурации и применения ее на сервере, в папке «External Config» должен находиться файл «Канал 1.1. json». (путь: C:\Users\***\Documents\FireSec3\External Config). Данный файл содержит список охранных зон и используется для загрузки в ПО СКУД Rubezh-STRAZH.
5.1.7	Для настройки интеграции необходимо во встроенном ПО, вкладка “Настройки СКД”, раздел “Интеграция с R3”, указать:
	контроллер с подключенным к нему модулем МС-1 (указан в ПО FireSec, вкладка «Планы», таблица «Устройства»),
	адрес канала через который подключен модуль МС-1,
	скорость обмена данных в RS-485 R3 (как правило 57 600)
	в окне «Файл конфигурации МС-1» загрузить файл, полученный из ПО FireSec (Канал 1.1. json). 
После обработки файла, появится список охранных зон. Для группировки охранных зон с точками доступа, необходимо указать какие точки доступа входят в требуемые охранные зоны. Сделать это можно, перетащив точку на зону. К каждой зоне может быть привязано несколько точек доступа.
5.1.8	После завершения настроек необходимо нажать “+” для добавления данной интеграции в систему, активировать ее в окне «Состояние» и сохранить настройку
5.1.9	Если нужно использовать функционал, при котором происходит взаимный обмен командами постановки/снятия охранных зон/точек прохода, плюс в ОС R3 может формироваться тревога, по факту взлома точки прохода, то создайте список охранных зон в ПО FireSec «Администратор» (не ниже 3.1.5.0), в которые будут помещены адресные охранные извещатели. Вид зоны: «обычная», «с задержкой входа/выхода», «без права снятия».
5.1.10	После, создайте виртуальные охранные зоны, в которые не будут добавляться охранные извещатели. В дальнейшем они будут ассоциированы с точками доступа и при формировании тревоги по датчику прохода в СКУД, виртуальная зона будет переходить в тревогу.
Важно! Данная охранная зона, должна иметь вид «STRAZH» и привязана к тому прибору, на котором должна будет сформироваться охранная тревога
5.1.11	Количество виртуальных охранных зон «STRAZH», должно совпадать с количеством точек прохода в СКУД, от которых нам нужно получить тревожное сообщение. 
Важно! МС-1, связывающий R3 и СКУД, в конфигурации ПО FireSec отображается как «Удаленный сервер», подключаемый 	на канал модуля сопряжения.
5.1.12	После создания конфигурации и применения ее на сервере, в папке «External Config» должен находиться файл «Канал 1.1. json». (путь: C:\Users\***\Documents\FireSec3\External Config). Данный файл содержит список охранных зон и используется для загрузки в ПО СКУД Rubezh-STRAZH.
5.1.13	Для настройки интеграции необходимо во встроенном ПО, вкладка “Настройки СКД”, раздел “Интеграция с R3”, указать:
	контроллер с подключенным к нему модулем МС-1 (указан в ПО FireSec, вкладка «Планы», таблица «Устройства»),
	адрес канала через который подключен модуль МС-1,
	скорость обмена данных в RS-485 R3 (как правило 57 600)
	в окне «Файл конфигурации МС-1» загрузить файл, полученный из ПО FireSec (Канал 1.1. json). 
После обработки файла, появится список охранных зон. Для группировки охранных зон с точками доступа, необходимо указать какие точки доступа входят в требуемые охранные зоны. Сделать это можно, перетащив точку на зону. К каждой зоне может быть привязано несколько точек доступа.
5.1.14	 В отличии от первого варианта реализации, в данном случае, нужно ассоциировать точку прохода с двумя зонами, с обычной и ее клоном, виртуальной. По завершению настройки, нужно нажать «+» для добавления данной интеграции в систему, активировать ее в окне «Состояние» и сохранить настройку
5.1.15	В результате реализации второго варианта интеграции, пользователь получает возможность осуществлять постановку/снятие зон ОС R3 через кодонаборный считыватель СКУД, управлять режимом работы (постановка/снятие) точки прохода по команде из R3 и получать тревогу в ОС R3 от датчика прохода, используемого в точке прохода СКУД.
5.1.16	Алгоритм управления ОС Рубеж R3 через кодонаборный считыватель СКУД, выглядит следующим образом:
	Покидая помещение, пользователь нажимает на кодонаборном считывателе клавишу 6
	подтверждает ввод команды завершающим символом (# или Ent)
	подтверждает свою манипуляцию картой, у которой есть право управления смены режима точки прохода.
В системе используются следующие коды:
1# - дежурный;
2# - заблокирована;
3# - заблокирована со стороны А;
4# - заблокирована со стороны В;
5# - разблокирована;
6# - на охране;
5.2	Интеграция с приборами биометрической идентификации. Общее описание.
5.2.1	В целях обеспечения дополнительной проверки доступа персонала на объектах, контроллеры Rubezh-STRAZH могут взаимодействовать с приборами биометрической идентификации BioSmart, ZKTeco и Hikvision. Контроллеры Rubezh-STRAZH взаимодействуют непосредственно с приборами минуя программное обеспечение верхнего уровня. Программное обеспечение BioSmart studio и интерфейс приборов ZKTeco и Hikvision необходим только для настройки приборов.
5.2.2	Поддержка приборов биометрической идентификации:
−	Реализована поддержка приборов BioSmart Quasar, BioSmart 5M. Осуществлена поддержка приборов, в ПО СКУД Rubezh-STRAZH с версией 1.2.210712.613 от 12.07.2021 и выше, предназначенных для идентификации человека по карте, геометрии лица, отпечатку пальцев и их комбинации. 
−	Реализована поддержка приборов ZKTeco, линейки Visible Light, с прошивкой у которой протокол «AC Push Protocol» с версией не ниже 3.1.2. Данную информацию можно посмотреть в меню прибора «информация о прошивке», а также запросить у вашего менеджера, в организации которой приобретался товар. Осуществлена поддержка приборов в ПО СКУД Rubezh-STRAZH с версией 1.2.220617.660 от 17.06.2022 и выше, предназначенных для идентификации человека по карте, геометрии лица и их комбинации.
−	Реализована поддержка приборов Hikvision на базе версии API протокола, а не модели. В текущей реализации ПО, поддержана версия 3.3.1 и выше) Осуществлена поддержка приборов, предназначенных для идентификации человека по карте, геометрии лица и их комбинации. 
5.2.3	Для правильной работы, приборы биометрии должны физически находиться в одной общей подсети с контроллером и быть подключены к модулю доступа через Wiegand.
5.2.4	Возможности системы:
−	Управление (добавление и удаление) биометрической информации осуществляется непосредственно из карточки персоны (встроенное ПО, вкладка «Персонал»)
−	 Биометрические данные автоматически не передаются в приборы. Для ее передачи / обновления необходимо нажатие кнопки «обновление биометрической информации» для выбранного типа. 
−	ПО СКУД Rubezh-Strazh поддерживает любой популярный формат файлов растровых изображений. 

Важно! При любом типе биометрической идентификации персона должна иметь карту (выданную или виртуальную) для связи ее с биометрической информацией. Это необходимо для авторизации пользователя, так как результат идентификации по биометрическим признакам передается через протокол Wiegand как номер карты.

5.2.5	Тип проверки (биометрические данные, или комбинация биометрических данных, кода, карты и т д) задается в настройках приборов.
Важно! В данной версии ПО не предусмотрена проверка на то, что добавленная (не через биометрический считыватель) фотография сотрудника подходит для его идентификации.
 
5.3	Интеграция с приборами биометрической идентификации ZKTeco. 
5.3.1	Предварительная настройка.
Для обеспечения регистрации терминала ZKTeco в системе, необходимо провести его предварительную настройку. В интерфейсе устройства:
−	В разделе «настройки сети» указать статический IP адрес.
−	В разделе «настройки облачного сервиса» указать IP адрес контроллера Rubezh-STRAZH, к которому терминал ZKTeco подключен по Wiegand, порт 443 и включить работу по HTTPS.
Важно! При первом добавлении в систему терминала ZKTeco, пользователи, добавленные в память терминала ZKTeco будут удалены. Также биометрические данные в ПО СКУД Rubezh-STRAZH будут очищены.
5.3.2	Добавление терминала ZKTeco в ПО СКУД Rubezh-STRAZH.
Для добавления терминала ZKTeco в ПО СКУД Rubezh-STRAZH нужно перейти во вкладку “Настройки СКД” раздел “Биометрия”. В карточке биометрического устройства указать: 
−	 Имя – пользовательское название для определения прибора (серийный номер, модель).
−	IP адрес - указать статический IP настроенный на терминале ZKTeco.
−	Модель - указать ZKTeco 3.x
−	Считыватель - указать контроллер и считыватель, к которому терминал ZKTeco подключено по Wiegand.
После заполнения карточки нажать «+»
5.3.3	Настройка биометрического доступа.
Для настройки биометрического доступа с идентификацией через терминал ZKTeco, нужно настроить точку прохода на основе контроллера и считывателя, к которому подключен терминал ZKTeco. Сформировать профиль доступа на точку прохода. В карточке сотрудника необходимо:
−	Добавить фотографию (загрузить файл или сделать снимок с веб-камеры).
−	 Добавить карту (можно добавить, как реальную, так и сгенерировать виртуальную карту).
−	Назначить профиль доступа и сохранить.
−	Нажать кнопку “Добавить биометрию” в карточке «Личные данные сотрудника»
−	Заполнить карточку «считывание биометрических данных», выбрать добавленное устройство ZKTeco и карту, по которой будет проходить идентификация сотрудника.
−	Нажать кнопку “Включить режим считывания биометрии”. В случае удачной связи появится сообщение о том, что данные приняты.
На терминал ZKTeco данные будут переданы автоматически, и идентификация будет доступна через 10–15 секунд.
В случае замены фотографии у сотрудника нужно или повторно добавить биометрию «карта – биометрический считыватель» или обновить базу данных сотрудников на биометрических считывателях целиком. При удалении биометрии очистка биометрии в приборе ZKTeco произойдет в течении 10 секунд.
Важно! Если в системе добавлено несколько терминалов ZKTeco, достаточно для сотрудника указать одну связку «карта-биометрический считыватель» (пункт «Добавить биометрию» в карточке Личные данные сотрудника), на остальные терминалы ZKTeco информация о сотруднике передастся автоматически.
5.3.4	Биометрический считыватель реагирует положительно вне зависимости от предоставленных прав доступа, но решение о предоставлении доступа выдает контроллер Rubezh-STRAZH. Так, при недостаточном уровне доступа, считыватель подтвердит идентификацию, но доступ будет заблокирован.
5.4	Интеграция с приборами биометрической идентификации Hikvision
5.4.1	Предварительная настройка.
Для обеспечения регистрации терминала Hikvision в системе, необходимо провести его предварительную настройку. В интерфейсе необходимо:
−	Добавить пользователя с правами администратора, задать login и password.
−	В разделе «настройки» в меню «связи для Wiegand» указать значение «Wiegand 34».
Важно! При первом добавлении терминала Hikvision, все биометрические данные о сотруднике в ПО СКУД Rubezh-STRAZH будут очищены. Пользователей, добавленных через прибор Hikvision, можно удалить только через сам прибор.
5.4.2	Добавление терминала в ПО СКУД Strazh Rubezh.
Для добавления терминала Hikvision в ПО СКУД Rubezh-STRAZH, необходимо перейти во вкладку “Настройки СКД” раздел “Биометрия”. В карточке биометрического устройства указать:
−	Имя - пользовательское название для определения терминала (серийный номер, модель)
−	IP адрес - указать статический IP настроенный в Hikvision
−	Модель - указать Hikvision ISAPI
−	Логин и пароль, указать (от созданного в терминале Hikvision) пользователя с правами администратора 
−	Считыватель - указать контроллер и считыватель, к которому терминал подключен по Wiegand.
После заполнения карточки нажать «+».
5.4.3	Настройка биометрического доступа.
Для настройки биометрического доступа с идентификацией через терминал Hikvision нужно настроить точку прохода на основе контроллера и считывателя, к которому подключен терминал Hikvision. Сформировать профиль доступа на точку прохода. В карточку сотрудника необходимо:
−	Добавить фотографию (загрузить файл или сделать снимок с веб-камеры).
−	Добавить карту (можно добавить, как реальную, так и сгенерировать виртуальную карту). 
−	Назначить профиль доступа и сохранить.
−	Нажать кнопку “Добавить биометрию” в карточке «Личные данные сотрудника»
−	Заполнить карточку «считывание биометрических данных», выбрать добавленный терминал Hikvision и карту, по которой будет проходить идентификация сотрудника.
−	Нажать кнопку “Включить режим считывания биометрии”. В случае удачной связи появится сообщение о том, что данные приняты.
На терминал Hikvision данные будут переданы автоматически, и идентификация будет доступна через 10–15 секунд.
5.4.4	В случае замены фотографии у сотрудника нужно или повторно добавить биометрию «карта – биометрический считыватель» в карточке Личные данные сотрудника, или обновить базу данных сотрудников на биометрических считывателях целиком. При удалении биометрии, очистка биометрии на терминале Hikvision произойдет в течении 10 секунд
Важно! если в системе добавлено несколько терминалов Hikvision, достаточно для сотрудника указать одну связку «карта-биометрический считыватель» (пункт «Добавить биометрию» в карточке Личные данные сотрудника), на остальные терминалы Hikvision информация о сотруднике передастся автоматически.
5.4.5	При добавлении еще одного терминала Hikvision, либо нового пользователя, необходимо обновить базу данных сотрудников на биометрических считывателях целиком (в карточке сотрудника, либо «Настройки СКД» в разделе «Биометрия»). 
5.4.6	В случае добавления нового пользователя у оборудования Hikvision есть ограничение скорости передачи информации. Скорость передачи зависит от количества сотрудников (приблизительно 5 человек в секунду). Передача информации осуществляется одновременно во все считыватели (параллельно).
5.4.7	Биометрический считыватель реагирует положительно вне зависимости от предоставленных прав доступа, но решение о предоставлении доступа выдает контроллер. Так, при недостаточном уровне доступа, считыватель подтвердит идентификацию, но доступ будет заблокирован.
 
5.5	Интеграция с приборами биометрической идентификации BioSmart.
5.5.1	Предварительная настройка. 
Для обеспечения регистрации терминала BioSmart в системе, необходимо провести предварительную настройку в интерфейсе терминала, Web интерфейсе либо через ПО BioSmart Studio.
5.5.2	Для BioSmart Quasar:
−	В разделе «настройки сети» указать статический адрес, IP адрес, маску и основной шлюз.
−	В разделе «Система» настроить параметры в разделах «Wiegand 0» и/или «Wiegand 1». Выберите направление передачи данных - Wiegand Out (передать на внешнее устройство) или Wiegand In (принять от внешнего устройства), режим работы терминала - «Wiegand 26», ширина импульса -  200мкс (рекомендованное значение), время между посылками - 2000 мкс (рекомендованное значение), тип данных Wiegand – Card ID (код RFID карты) или UID (код сотрудника (ID)).
5.5.3	Для BioSmart 5M настройки лучше производить в ПО BioSmart- STUDIO:
−	По умолчанию на терминале установлен IP-адрес 172.25.10.71. сменить адрес можно через web-интерфейс либо ПО BioSmart- STUDIO. Выберите свойства терминала и измените сетевые параметры в соответствии с настройками вашей сети.
−	Во вкладке «Системные», раздел «Доп. устройства», для параметра «Режим Wiegand выхода» выбрать значение «Wiegand-26» 

Подробнее о настройках терминалов BioSmart указано в руководствах по эксплуатации к конкретным терминалам
5.5.4	Для добавления терминала BioSmart в ПО СКУД Rubezh-STRAZH, перейти во вкладку «Настройки СКД» раздел «Биометрия». В карточке биометрического считывателя указать:
−	Имя - пользовательское название для определения прибора (серийный номер, модель). 
−	IP адрес - указать статический IP настроенный в приборе BioSmart. 
−	Модель – выбрать из списка необходимую модель BioSmart. 
−	Считыватель - указать контроллер и считыватель, к которому прибор BioSmart подключено по Wiegand
После заполнения карточки нажать «+»
5.5.5	Настройка биометрического доступа. 
Для настройки биометрического доступа нужно настроить точку прохода на основе контроллера и считывателя, к которому подключен терминал BioSmart. Сформировать профиль доступа на точку прохода. В карточке сотрудника необходимо:
−	Добавить фотографию (загрузить файл или сделать снимок с веб-камеры).
−	Добавить карту (можно добавить, как реальную, так и сгенерировать виртуальную карту). 
−	Назначить профиль доступа и сохранить.
−	Нажать кнопку “Добавить биометрию” в карточке «Личные данные сотрудника»
−	Заполнить карточку «считывание биометрических данных», выбрать добавленный терминал BioSmart и карту, по которой будет проходить идентификация сотрудника.
−	Нажать кнопку “Включить режим считывания биометрии”. В случае удачной связи появится сообщение о том, что данные приняты.
Важно! Если в системе добавлено несколько терминалов BioSmart, то для каждого сотрудника нужно указывать связку «карта-биометрический считыватель» (пункт добавить биометрию в карточке Личные данные сотрудника) с каждым прибором BioSmart.
В случае замены фотографии у сотрудника, нужно или повторно добавить биометрию «карта – биометрический считыватель» в карточке Личные данные сотрудника, или обновить базу данных сотрудников на биометрических считывателях целиком.
 
5.6	Интеграция с системами распознавания гос. номеров
5.6.1	Интеграция позволяет организовать контроль и учет проезда транспорта через точку доступа типа Шлагбаум с идентификацией персоны по номеру авто, карте или номеру и карте, управлять доступом и получать отчеты через ПО СКУД Rubezh-Strazh
5.6.2	В качестве устройств распознавания автомобильных номеров поддерживается сервер RVI-Авто (из состава RVI оператор) или «умные» камеры с поддержкой распознавания номеров на борту и передачей событий по протоколу ONVIF.
5.6.3	Обрабатывать события с устройств распознавания будет контроллер Rubezh-STRAZH, который управляет шлагбаумом, связанным с устройством. Это позволяет обеспечить дополнительную отказоустойчивость системы.
5.6.4	В данной версии ПО СКУД Rubezh-Strazh, поддерживается RVI-Авто с версиями 1.4 и 2.0.
5.6.5	Для настройки функции распознавания номеров необходимо установленное на вашем сервере лицензионное ПО RVI-Авто, а также физически подключенные камеры. Настройки распознавания номеров производятся в ПО RVI-Авто. В разделе «Соединение» установите соединение с физической камерой и укажите пользовательское наименование камеры. Для настройки интеграции вам потребуется RTSP ссылка (находиться в нижней части экрана). Необходимо скопировать только часть ссылки – IP адрес сервера. 
Пример ссылки: rtsp://172.16.135.84:19007/h264/1
Часть для копирования: 172.16.135.84
5.6.6	Интеграция с распознаванием номеров настраивается в ПО СКУД Rubezh-Strazh.
5.6.7	Что бы настроить функцию распознавания номеров в ПО СКУД Rubezh-Strazh, во вкладке «Настройка СКД» разделе «Распознавание номеров» заполните карточку:
•	Имя – пользовательское название для определения прибора/системы
•	ONVIF URL – путь к ONVIF серверу. Состоит из адреса вашего сервера (часть ссылки скопированной в ПО RVI-Авто), и статическим описанием – порт сервера на котором работает RVI-Авто :19006/onvif/ device_service. 
Например: http://192.168.10.01:19006/onvif/device_service 
•	Тип – тип события. Доступно для выбора стандартные ONVIF (для «умных» камер) и события формата RVI-Авто (для интеграции с RVI-Авто).
•	Логин и пароль – вводиться в случае если на физической камере установлены эти параметры.
В разделе «Точки прохода» создайте и/или настройте точку прохода типа шлагбаум, с обязательным указанием пунктов: контроллер, считыватель либо реле и устройство распознавания номеров. В разделе «профили входа» для каждого сотрудника в личной карточке, укажите номер автомобиля. Во вкладке «Администрирование доступа», раздел «Профили доступа», создайте профиль доступа и укажите расписание.
5.6.8	После распознавания номера в журнале событий появится запись о совершенном событии, на основании которого могут быть построены отчеты (вкладка «Отчеты»).
5.7	Интеграция с внешними системами через REST API
5.7.1	Для организации работы контроля и учета доступа можно использовать напрямую REST API ПО Страж. 
5.7.2	При помощи интеграции внешнего ПО через API можно осуществлять, как контроль времени присутствия на объекте, так и управление точками прохода, добавление учетных данных пользователей, их профилей доступа и т.д. 
5.7.3	API ПО Страж доступно по ссылке https://IP-контроллера/api-docs/ui/ так же данную ссылку можно найти в разделе «Настройки контроллера» на вкладке «О системе».
