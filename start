3	Начало работы
3.1	Первый запуск контроллера
3.1.1	По окончании монтажа необходимо подключить кабель сетевого соединения Ethernet и подать питание на контроллер и модули.
3.1.2	Следует иметь в виду, что первый запуск контроллера может занять до 7 минут (идет процесс распаковки и установки встроенного программного обеспечения). В течение этого времени индикатор ошибки будет моргать двойными импульсами раз в две секунды.

3.2	Обнаружение контроллера
3.2.1	Контроллер настроен заводом-изготовителем для работы в режиме DHCP. То есть при подключении к сети он получит автоматически IP-адрес от сервера DHCP. Если в системе отсутствует DHCP или точка подключения находится за маршрутизатором с фильтрацией трафика, возможно подключение контроллера непосредственно к компьютеру. В этом случае контроллер получит так называемый link-local-адрес.
3.2.2	Для поиска контроллера в сети используется протокол обнаружения UPNP. При любом из вышеперечисленных подключений, контроллер появится в сетевом окружении под названием «RUBEZH STR20-IP» или «RUBEZH КД-PRO» с указанием серийного номера устройства. При выборе этого устройства будет автоматически запущен веб-интерфейс управления. Заводом-изготовителем предустановлены следующие логин и пароль: «admin», «abc12345».
3.2.3	Для обнаружения контроллера убедитесь, что в сетевых настройках вашего ПК параметры «IP версии 4» и «IP версии 6» выставлены на автоматическое получение адресов. Сетевые настройки контроллера могут быть любые (статический или динамически IP адрес) они не влияют на подключение к ПК на прямую. По умолчанию в контроллере установлен динамический IP адрес.
Важно! Если подключение контроллера напрямую к ПК проводное, WiFi модуль на плате контроллера должен быть отключен. 
3.2.4	После подачи питания контроллер отобразиться в сетевом окружении примерно через одну минуту.
 
3.3	Начальная настройка контроллера
3.3.1	Сразу после активизации контроллера необходимо провести ряд настроек для его корректной работы в дальнейшем. Все настройки устройства находятся в пункте меню «Настройки контроллера». Данные настройки являются уникальными для каждого устройства и должны быть установлены через его веб-интерфейс сразу после включения устройства.

3.4	Установка сетевых параметров
3.4.1	Прежде чем продолжать работу с контроллером, необходимо установить правильный режим работы сети.
3.4.2	Контроллер поддерживает два режима работы в сетях Ethernet:
3.4.3	«Динамический IP». В этом случае все параметры будут установлены автоматически с помощью DHCP-сервера согласно настроенной политике;
3.4.4	«Статический IP». В этом случае необходимо установить фиксированный IP-адрес и прочие параметры сети вручную согласно параметрам сети.
3.4.5	После применения настроек, в случае динамического IP, связь с контроллером может пропасть. В таком случае необходимо осуществить его поиск в сетевом окружении заново (см. раздел Обнаружение контроллера).

3.5	Установка времени
3.5.1	Для корректной работы системы, в частности для правильного ведения журнала событий, необходимо установить часы контроллера. Для задания времени вручную, сначала необходимо установить дату и часовой пояс. Потом задать время.
3.5.2	В качестве более простого и быстрого способа можно использовать кнопку "Синхронизировать с ПК". В этом случае, на контроллере будут установлены параметры даты и времени (включая часовой пояс) с компьютера. Если контроллер при этом находится в другом часовом поясе (удаленное подключение), то необходимо просто изменить часовой пояс после этого.
3.5.3	Дополнительно, контроллер поддерживает синхронизацию времени через NTP-сервер. В этом случае следует указать доступный сервер и часовой пояс контроллера. Остальные параметры будут установлены автоматически.

3.6	Поиск устройств на линии
3.6.1	Так как контроллер взаимодействует с оборудованием точки доступа через модули, то необходимо активизировать их в системе. OSDP-устройства поддерживают протокол обнаружения. Так как сканирование линии идет по адресам и таймаут отсутствия ответа достаточно большой, то сканирование занимает достаточно большое время. Для уменьшения этого времени в панели поиска устройств можно выбрать диапазон адресов и диапазон скоростей, на которых будет произведена попытка найти устройства. Согласно заводским настройкам, поиск осуществляется на всем диапазоне адресов при максимальной скорости канала.
3.6.2	Адрес модуля доступа устанавливается с помощью колодки DIP переключателей. У всех устройств на линии адреса должны быть разными.  Адрес по колодке определяется в двоичном виде и равен сумме чисел, соответствующих включенным переключателям 1-5 (от младшего к старшему). Максимальным значением адреса является 031 (001+002+004+008+016). При изменении адреса модуль необходимо перезагрузить по питанию.

3.6.3	По результатам поиска будет выдана таблица найденных устройств с указанием их скорости обмена. В случае, если устройство поддерживает OSDP-команду смены скорости, то имеется возможность переключить найденные устройства на нужную скорость обмена (модули поддерживают эту команду).
3.6.4	В результатах поиска всегда присутствует сама плата контроллера для возможности использования датчиков SENS1 и SENS2. Под контроллер на линии OSDP зарезервирован адрес 126. Однако, для удобства пользователя, плата контроллера показывается под адресом 0. OSDP-устройства также будут представлены в этой таблице с указанием модели и производителя.
3.6.5	Для использования найденного устройства в системе необходимо нажать кнопку «Добавить» в интерфейсе поиска устройств.   

3.7	Настройки OSDP
3.7.1	Контроллер осуществляет взаимодействие с модулями по шинам OSDP (интерфейс RS-485). Заводом-изготовителем контроллер настроен на оптимальное взаимодействие. Однако, при использовании сторонних OSDP-устройств, может понадобиться изменение параметров линий.
3.7.2	Некоторые устройства требуют дополнительной задержки в процессе опроса, в таком случае следует увеличить «Интервал опроса». Он задается в миллисекундах.
3.7.3	Параметр «Таймаут ответа» задает максимальное время ожидания ответа устройства в миллисекундах. Контроллер использует интеллектуальный опрос устройств и опрашивает не отвечающие устройства по одному за цикл опроса. Однако наличие таких устройств добавляет задержку на весь цикл. Данный параметр может быть уменьшен, но необходимо убедиться, что все используемые устройства достаточно быстрые.
3.7.4	Скорость линии необходимо установить по самому медленному устройству на линии. Все модули поддерживают работу на максимальной скорости (заводская настройка).

3.8	Контроль связи OSDP
3.8.1	Контроллер использует данную функцию для анализа состояния запросов и ответов от контроллера к модулям доступа. Индикация состояния качества связи контроллера и модуля доступа представлена в интерфейсе в виде строки состояния, цвет которой зависит от количества неудачных ответов на запросы контроллера:
−	неудачных ответов менее 5% – зеленый цвет;
−	неудачных ответов более 5%, но менее 40% – желтый цвет;
−	неудачных ответов более 40 % –  красный цвет.
3.9	Обновление
3.9.1	Контроллер поддерживает обновление встроенного ПО через веб-интерфейс. Текущую версию можно посмотреть в заголовке панели. При нажатии на информацию о версии ПО открывается таблица версий всех программных компонент.
3.9.2	Для обновления необходимо выбрать файл обновления (на данный момент файлы располагаются на сайте продукта и могут быть скачаны оттуда) и установить его. В контроллере присутствует защита от неправильного файла обновления. Если файл обновления не подходит, то будет выдано сообщение о соответствующей ошибке. Обновление проводится в режиме отката по ошибке. Если в процессе обновления возникнет какая-нибудь ошибка, то система будет автоматически восстановлена на состояние до начала обновления.
3.9.3	Обновление идет без полной остановки работы контроллера. В процессе обновления возможны короткие периоды неактивности контроллера. На некоторых фазах перезапускаются компоненты, в этом случае в интерфейсе могут показываться ошибки связи. Данное поведение считается нормальным.
3.9.4	В процессе обновления присутствует индикация в виде трехкратного мигания красным светодиодом с интервалом 2 секунды.
3.9.5	Обновление прошивки сохраняет все настройки контроллера (включая зарегистрированные карты, пользователей и журналы). Таким образом, контроллер может продолжать использоваться со всеми своими настройками сразу после обновления ПО.
3.9.6	Через веб-интерфейс контроллера можно обновить программное обеспечение модулей. Действия аналогичные обновлению контроллера.
3.9.7	Пакеты обновления могут быть полные (слово FULL в названии файла) и инкрементальные. В некоторых случаях может потребоваться поставить специальную прошивку для отладки (слово DEVELOP в названии файла). В такой прошивке присутствует инструмент удаленного мониторинга журналов и удаленного доступа.

3.10	 Мониторинг состояния (ONVIF)
3.10.1	Контроллеры поддерживают несколько способов передачи информации о своем состоянии во внешние средства мониторинга.
3.10.2	Контроллеры поддерживают передачу информации о сетевой активности, состоянии системы хранения данных и загрузке процессора по протоколу SNMP.
3.10.3	Для работы на объектах транспортной безопасности, контроллеры поддерживают ONVIF протокол систем мониторинга оборудования объектов транспортной инфраструктуры. Для его активизации необходимо установить параметры авторизации.

3.11	 Перезагрузка контроллера
3.11.1	Веб-интерфейс поддерживает функцию перезагрузки контроллера в случае необходимости.
3.11.2	Если контроллер перестал отвечать на API-запросы, можно перезапустить REST-сервер.

3.12	 Возврат заводских параметров
3.12.1	Если в процессе настройки сетевых параметров контроллера возникли нерешаемые трудности, или забыт пароль доступа в систему, есть возможность вернуть его к заводским настройкам. Для этого следует открыть крышку и удерживать кнопку RESET в течение 10 секунд. Удерживать кнопку необходимо до появления однократного мигания красного светодиода с интервалом 1 секунда. После отпускания кнопки все пользовательские данные будут стерты, однако все обновления ПО сохранятся.
3.12.2	В случае, если необходимо вернуть контроллер к заводской прошивке и полностью стереть все данные и настройки, удерживайте кнопку RESET в течение 20 секунд до начала второго однократного мигания красного светодиода с интервалом 1 секунда. После отпускания кнопки контроллер перезагрузится и начнет процесс восстановления. О чем будет свидетельствовать индикация красного светодиода (двойные импульсы раз в 2 секунды). Процесс восстановления занимает порядка 7 минут.

3.13	 Системный журнал и диагностика
3.13.1	В некоторых случаях может понадобиться диагностика работы системы для поиска проблемы или программной ошибки. Панель «Системный журнал» позволяет включить вывод внутренней отладочной информации и сохранить ее в файл. После этого, файл может быть отослан в службу технической поддержки для анализа поведения. Важно, в файл не записывается секретная информация: пароли, пин-коды и так далее. Записи с этими данными маскируются значками ****.

3.14	 О системе
3.14.1	Вкладка веб-интерфейса «О системе» позволяет посмотреть текущую информацию о контроллере. На вкладке представлена кнопка-маячок (справа в виде лампочки). При нажатии на нее включается 30-секундная индикация красным светодиодом на соответствующем контроллере.
